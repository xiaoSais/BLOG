<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>四、流（stream） | Secret</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="Just playing around">
    <link rel="preload" href="/blog/assets/css/0.styles.f1ac6944.css" as="style"><link rel="preload" href="/blog/assets/js/app.26c01ea0.js" as="script"><link rel="preload" href="/blog/assets/js/2.9ce53f7d.js" as="script"><link rel="preload" href="/blog/assets/js/15.eca67785.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.08cce06b.js"><link rel="prefetch" href="/blog/assets/js/11.2594fc4b.js"><link rel="prefetch" href="/blog/assets/js/12.d96d8d93.js"><link rel="prefetch" href="/blog/assets/js/13.8ac94df3.js"><link rel="prefetch" href="/blog/assets/js/14.373704e1.js"><link rel="prefetch" href="/blog/assets/js/16.41264e01.js"><link rel="prefetch" href="/blog/assets/js/17.f18d9ddd.js"><link rel="prefetch" href="/blog/assets/js/18.0dcd4f16.js"><link rel="prefetch" href="/blog/assets/js/19.830b806c.js"><link rel="prefetch" href="/blog/assets/js/20.b5380bf4.js"><link rel="prefetch" href="/blog/assets/js/21.a4b60ec1.js"><link rel="prefetch" href="/blog/assets/js/22.ee5cd766.js"><link rel="prefetch" href="/blog/assets/js/23.fbf04042.js"><link rel="prefetch" href="/blog/assets/js/24.d1baf8df.js"><link rel="prefetch" href="/blog/assets/js/25.729bd47c.js"><link rel="prefetch" href="/blog/assets/js/26.784848a5.js"><link rel="prefetch" href="/blog/assets/js/27.717b6412.js"><link rel="prefetch" href="/blog/assets/js/28.117cba37.js"><link rel="prefetch" href="/blog/assets/js/29.de01964b.js"><link rel="prefetch" href="/blog/assets/js/3.6b276a9f.js"><link rel="prefetch" href="/blog/assets/js/30.137c9e10.js"><link rel="prefetch" href="/blog/assets/js/31.db63a6b5.js"><link rel="prefetch" href="/blog/assets/js/32.a3541c64.js"><link rel="prefetch" href="/blog/assets/js/33.9354de8c.js"><link rel="prefetch" href="/blog/assets/js/34.51679fce.js"><link rel="prefetch" href="/blog/assets/js/35.61c8b73c.js"><link rel="prefetch" href="/blog/assets/js/36.2ec860f2.js"><link rel="prefetch" href="/blog/assets/js/37.0a984f02.js"><link rel="prefetch" href="/blog/assets/js/38.afdf999b.js"><link rel="prefetch" href="/blog/assets/js/39.8c521d66.js"><link rel="prefetch" href="/blog/assets/js/4.9c2dd85d.js"><link rel="prefetch" href="/blog/assets/js/40.74118903.js"><link rel="prefetch" href="/blog/assets/js/41.31b33a79.js"><link rel="prefetch" href="/blog/assets/js/42.310c44ad.js"><link rel="prefetch" href="/blog/assets/js/43.11560dc9.js"><link rel="prefetch" href="/blog/assets/js/44.9b4d3a40.js"><link rel="prefetch" href="/blog/assets/js/45.17cf00d6.js"><link rel="prefetch" href="/blog/assets/js/46.58339149.js"><link rel="prefetch" href="/blog/assets/js/47.28d7179c.js"><link rel="prefetch" href="/blog/assets/js/5.a5ec00e6.js"><link rel="prefetch" href="/blog/assets/js/6.afec5c10.js"><link rel="prefetch" href="/blog/assets/js/7.85f92572.js"><link rel="prefetch" href="/blog/assets/js/8.16e58ca1.js"><link rel="prefetch" href="/blog/assets/js/9.9fb55767.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.f1ac6944.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Secret</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/blog/blog/document/swiper.html" class="nav-link">
  技术文档
</a></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/blog/blog/document/swiper.html" class="nav-link">
  技术文档
</a></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>技术文档</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>深入axios</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Express</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Node.js</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/blog/Node/process.html" class="sidebar-link">一、Node中的进程与线程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/blog/Node/process.html#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/blog/blog/Node/process.html#child-process" class="sidebar-link">child_process</a></li><li class="sidebar-sub-header"><a href="/blog/blog/Node/process.html#cluster模块" class="sidebar-link">cluster模块</a></li></ul></li><li><a href="/blog/blog/Node/memory.html" class="sidebar-link">二、内存控制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/blog/Node/memory.html#内存分配" class="sidebar-link">内存分配</a></li><li class="sidebar-sub-header"><a href="/blog/blog/Node/memory.html#v8的垃圾回收机制" class="sidebar-link">v8的垃圾回收机制</a></li><li class="sidebar-sub-header"><a href="/blog/blog/Node/memory.html#node查看内存占用" class="sidebar-link">Node查看内存占用</a></li></ul></li><li><a href="/blog/blog/Node/sync.html" class="sidebar-link">三、异步IO</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/blog/Node/sync.html#阻塞io和非阻塞io" class="sidebar-link">阻塞IO和非阻塞IO</a></li><li class="sidebar-sub-header"><a href="/blog/blog/Node/sync.html#现实中的异步io" class="sidebar-link">现实中的异步IO</a></li><li class="sidebar-sub-header"><a href="/blog/blog/Node/sync.html#node中的异步io" class="sidebar-link">Node中的异步IO</a></li></ul></li><li><a href="/blog/blog/Node/stream.html" aria-current="page" class="active sidebar-link">四、流（stream）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/blog/Node/stream.html#缓冲" class="sidebar-link">缓冲</a></li><li class="sidebar-sub-header"><a href="/blog/blog/Node/stream.html#应用层" class="sidebar-link">应用层</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue生态</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>跨域</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>学习轨迹</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>散文随笔</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="四、流（stream）"><a href="#四、流（stream）" class="header-anchor">#</a> 四、流（stream）</h1> <p>Node.js 中有四种流，可读流（Readable）、可写流（Writable）、双工流（Duplex）、在读写过程中可以修改和变换数据的 Duplex 流（Transform），所有的流都是 EventEmitter 的实例。</p> <h2 id="缓冲"><a href="#缓冲" class="header-anchor">#</a> 缓冲</h2> <p>可读流和可写流都会保存在内部的缓冲器中。</p> <p>可缓冲区的大小由构造函数中的 hignWaterMark 确定。</p> <p>当调用 stream.push(chunk) 时，数据会被缓存到可读流中。如果流的消费者没有调用 stream.read() 数据会被保存到内部队列中直到被消费。</p> <p>一旦缓冲区大小超过 hignWaterMark 规定的值时，流会暂时从底层读取数据到缓冲区，直到缓冲区数据被消费（也就是说，流会停止调用内部的用于填充可读缓冲区的 readable._read()）。</p> <p>当调用 writable.write(chunk)时，数据会被缓冲在可写流中。当内部的可写缓冲大小小于 hignWaterMark 时，调用 writable.write() 会返回true，否则返回false。</p> <p>stream.pipe() 是为了限制数据的缓冲可接受程度，也就是读写速度不一致的源头与目的地不会压垮内存。</p> <h2 id="应用层"><a href="#应用层" class="header-anchor">#</a> 应用层</h2> <h3 id="可读流"><a href="#可读流" class="header-anchor">#</a> 可读流</h3></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/blog/Node/sync.html" class="prev">
        三、异步IO
      </a></span> <span class="next"><a href="/blog/blog/vue/vue.html">
        一、Vue.js
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.26c01ea0.js" defer></script><script src="/blog/assets/js/2.9ce53f7d.js" defer></script><script src="/blog/assets/js/15.eca67785.js" defer></script>
  </body>
</html>
